<sect2><title>&nbsp;</title><para>&nbsp;</para></sect2>

<sect2>
<title>Glibc installation</title>

<para>The Glibc build system is very well self-contained and will install
perfectly, even though our compiler specs file and linker scripts are still
pointing at <filename>/tools</filename>. We cannot adjust the specs and
ldscripts before the Glibc install, because the Glibc autoconf tests would then
give bogus results and thus defeat our goal of achieving a clean build.</para>

<para>Before starting to build Glibc, remember to unpack the Glibc-linuxthreads
again inside the <filename>glibc-&glibc-version;</filename> directory, and to
unset any environment variables that override the default optimization
flags.</para>

<para>Then apply the same patch we used previously:</para>
                                                                                
<para><screen><userinput>patch -Np1 -i ../glibc-2.3.2-sscanf-1.patch
</userinput></screen></para>

<para>The documentation that comes with Glibc recommends to build the package
not in the source directory but in a separate, dedicated directory:</para>

<para><screen><userinput>mkdir ../glibc-build
cd ../glibc-build</userinput></screen></para>

<para>Now prepare Glibc for compilation:</para>

<para><screen><userinput>../glibc-&glibc-version;/configure --prefix=/usr \
&nbsp;&nbsp;&nbsp;&nbsp;--disable-profile --enable-add-ons \
&nbsp;&nbsp;&nbsp;&nbsp;--libexecdir=/usr/bin --with-headers=/usr/include</userinput></screen></para>

<para>The meaning of the configure options:</para>

<itemizedlist>
<listitem><para><userinput>--disable-profile</userinput>: This disables the
building of the libraries with profiling information. Omit this option if you
plan to do profiling.</para></listitem>

<listitem><para><userinput>--enable-add-ons</userinput>: This enables any
add-ons that we installed with Glibc, in our case Linuxthreads.</para></listitem>

<listitem><para><userinput>--libexecdir=/usr/bin</userinput>: This will
cause the <filename>pt_chown</filename> program to be installed in the
<filename>/usr/bin</filename> directory.</para></listitem>

<listitem><para><userinput>--with-headers=/usr/include</userinput>: This
ensures that the kernel headers in <filename>/usr/include</filename> are used
for this build. If you don't pass this switch then the headers from
<filename>/tools/include</filename> are used which of course is not ideal
(although they should be identical). Using the switch has the advantage
that you will be informed immediately should you have forgotten to install the
kernel headers into <filename>/usr/include</filename>.</para></listitem>
</itemizedlist>

<para>Compile the package:</para>

<para><screen><userinput>make</userinput></screen></para>

<para>Test the results:</para>

<para><screen><userinput>make check</userinput></screen></para>

<para>And install the package:</para>

<para><screen><userinput>make install</userinput></screen></para>

<para>The locales that can make your system respond in a different language
weren't installed by the above command. Do it with this:</para>

<para><screen><userinput>make localedata/install-locales</userinput></screen></para>

<para>An alternative to running the previous command is to install only those
locales which you need or want. This can be achieved using the
<userinput>localedef</userinput> command. Information on this can be found in
the <filename>INSTALL</filename> file in the
<filename>glibc-&glibc-version;</filename> tree. However,  there are a number
of locales that are essential for the tests of future packages to pass
correctly. The following instructions, in place of the install-locales
command above, will install the minimum set of locales necessary for the
tests to run successfully:</para>

<para><screen><userinput>mkdir -p /stage1/lib/locale
localedef -i de_DE -f ISO-8859-1 de_DE
localedef -i de_DE@euro -f ISO-8859-15 de_DE@euro
localedef -i en_HK -f ISO-8859-1 en_HK
localedef -i en_PH -f ISO-8859-1 en_PH
localedef -i en_US -f ISO-8859-1 en_US
localedef -i es_MX -f ISO-8859-1 es_MX
localedef -i fr_FR -f ISO-8859-1 fr_FR
localedef -i fr_FR@euro -f ISO-8859-15 fr_FR@euro
localedef -i it_IT -f ISO-8859-1 it_IT
localedef -i ja_JP -f EUC-JP ja_JP</userinput></screen></para>

<para>Finally, build the linuxthreads man pages:</para>

<para><screen><userinput>make -C ../glibc-2.3.2/linuxthreads/man</userinput></screen></para>

<para>And install these pages:</para>

<para><screen><userinput>make -C ../glibc-2.3.2/linuxthreads/man install</userinput></screen></para>

</sect2>

